<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم المعلم الاحترافية - نافس</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            direction: rtl;
            color: #e2e8f0;
            overflow-x: hidden;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 300px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            position: relative;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, transparent 100%);
            z-index: -1;
        }

        .sidebar-header {
            padding: 30px 25px;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            text-align: center;
            position: relative;
        }

        .logo {
            font-size: 2.2em;
            font-weight: 900;
            color: #a5b4fc;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(165, 180, 252, 0.5);
        }

        .teacher-info {
            color: #cbd5e1;
            font-size: 0.9em;
            font-weight: 500;
        }

        .teacher-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding: 4px 10px;
            background: rgba(16, 185, 129, 0.2);
            border-radius: 15px;
            font-size: 0.8em;
            color: #10b981;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-section-title {
            padding: 0 25px 10px;
            font-size: 0.8em;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: #cbd5e1;
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 0 25px 25px 0;
            margin-left: 15px;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1));
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .nav-link:hover::before,
        .nav-link.active::before {
            transform: translateX(0);
        }

        .nav-link:hover,
        .nav-link.active {
            background: linear-gradient(145deg, #6366f1, #4f46e5);
            color: white;
            transform: translateX(-5px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .nav-icon {
            width: 28px;
            height: 28px;
            margin-left: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .nav-text {
            font-weight: 600;
            white-space: nowrap;
            transition: opacity 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .nav-badge {
            background: #ef4444;
            color: white;
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 10px;
            margin-right: auto;
            animation: bounceIn 0.5s ease;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .sidebar.collapsed .nav-text,
        .sidebar.collapsed .nav-badge {
            opacity: 0;
            width: 0;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.05) 0%, rgba(226, 232, 240, 0.05) 100%);
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px 35px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sidebar-toggle {
            background: rgba(99, 102, 241, 0.2);
            border: none;
            color: #a5b4fc;
            font-size: 1.5em;
            cursor: pointer;
            padding: 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: rgba(99, 102, 241, 0.3);
            transform: scale(1.1);
        }

        .page-title {
            font-size: 2em;
            font-weight: 900;
            background: linear-gradient(135deg, #e2e8f0, #a5b4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 0.9em;
            color: #94a3b8;
            margin-top: 5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .control-panel {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e2e8f0;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 600;
        }

        .control-btn:hover {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .emergency-stop {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.4) !important;
            color: #fca5a5 !important;
        }

        .emergency-stop:hover {
            background: rgba(239, 68, 68, 0.4) !important;
        }

        .notification-center {
            position: relative;
        }

        .notification-bell {
            background: none;
            border: none;
            color: #a5b4fc;
            font-size: 1.4em;
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
        }

        .notification-bell:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: notificationPulse 2s infinite;
        }

        @keyframes notificationPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(145deg, #10b981, #059669);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: livePulse 1.5s infinite;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .quick-stat {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quick-stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.2);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            background: linear-gradient(145deg, #6366f1, #4f46e5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            color: white;
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 900;
            color: #e2e8f0;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #94a3b8;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .stat-trend {
            font-size: 0.9em;
            font-weight: 600;
        }

        .trend-up {
            color: #10b981;
        }

        .trend-down {
            color: #ef4444;
        }

        /* Weekly Progress Section */
        .weekly-progress-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .progress-title {
            font-size: 1.8em;
            font-weight: 900;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weekly-progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            height: 20px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }

        .weekly-progress-fill {
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            height: 100%;
            border-radius: 15px;
            transition: width 0.8s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 700;
            font-size: 0.9em;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #94a3b8;
            font-size: 0.9em;
        }

        /* Question Management Styles */
        .question-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .method-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            backdrop-filter: blur(20px);
        }

        .method-card:hover {
            transform: translateY(-5px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.3);
        }

        .method-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #a5b4fc;
        }

        .method-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 10px;
        }

        .method-description {
            color: #94a3b8;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .recent-questions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(145deg, #1e293b, #334155);
            border-radius: 25px;
            padding: 35px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.6em;
            font-weight: 700;
            color: #e2e8f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8em;
            color: #94a3b8;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e2e8f0;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .form-control::placeholder {
            color: #94a3b8;
        }

        .btn {
            background: linear-gradient(145deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: linear-gradient(145deg, #10b981, #059669);
        }

        .btn-warning {
            background: linear-gradient(145deg, #f59e0b, #d97706);
        }

        .btn-danger {
            background: linear-gradient(145deg, #ef4444, #dc2626);
        }

        .btn-secondary {
            background: linear-gradient(145deg, #64748b, #475569);
        }

        .upload-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #10b981, #059669);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 3000;
            max-width: 400px;
        }

        .notification-toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification-toast.error {
            background: linear-gradient(145deg, #ef4444, #dc2626);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
        }

        .notification-toast.warning {
            background: linear-gradient(145deg, #f59e0b, #d97706);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(100%);
                position: fixed;
                height: 100vh;
                z-index: 1001;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                padding: 15px;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .header {
                padding: 20px;
            }

            .page-title {
                font-size: 1.5em;
            }

            .question-methods {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast"></div>

    <div class="dashboard-container">
        <!-- Enhanced Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">🏆 نافس</div>
                <div class="teacher-info">الأستاذ نواف الصبحي</div>
                <div class="teacher-status">
                    <div class="status-dot"></div>
                    متصل الآن
                </div>
            </div>
            
            <div class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">التحكم الرئيسي</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" data-section="live-control">
                            <div class="nav-icon">📡</div>
                            <div class="nav-text">التحكم المباشر</div>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="dashboard">
                            <div class="nav-icon">📊</div>
                            <div class="nav-text">لوحة المعلومات</div>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">إدارة المحتوى</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="questions">
                            <div class="nav-icon">❓</div>
                            <div class="nav-text">بنك الأسئلة</div>
                            <div class="nav-badge">12</div>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="competitions">
                            <div class="nav-icon">🏆</div>
                            <div class="nav-text">إدارة المسابقات</div>
                            <div class="nav-badge">3</div>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">المتابعة والتحليل</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="students">
                            <div class="nav-icon">👥</div>
                            <div class="nav-text">متابعة الطلاب</div>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="analytics">
                            <div class="nav-icon">📈</div>
                            <div class="nav-text">التحليلات المتقدمة</div>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="reports">
                            <div class="nav-icon">📊</div>
                            <div class="nav-text">التقارير الذكية</div>
                        </a>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">الإعدادات</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-section="settings">
                            <div class="nav-icon">⚙️</div>
                            <div class="nav-text">إعدادات النظام</div>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Enhanced Main Content -->
        <main class="main-content">
            <!-- Enhanced Header -->
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
                    <div>
                        <h1 class="page-title" id="pageTitle">التحكم المباشر في المسابقات</h1>
                        <div class="page-subtitle" id="pageSubtitle">إدارة شاملة ومراقبة فورية للمسابقات النشطة</div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="control-panel">
                        <button class="control-btn" onclick="pauseAllCompetitions()">⏸️ إيقاف مؤقت</button>
                        <button class="control-btn emergency-stop" onclick="emergencyStop()">🛑 إيقاف طارئ</button>
                    </div>
                    <div class="notification-center">
                        <button class="notification-bell" onclick="toggleNotifications()">
                            🔔
                            <span class="notification-badge" id="notificationCount">7</span>
                        </button>
                    </div>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>مباشر</span>
                    </div>
                </div>
            </header>

            <!-- Live Control Section -->
            <div id="live-control-section" class="content-section">
                <!-- Quick Statistics -->
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="stat-icon">👥</div>
                        <div class="stat-number" id="activeStudents">47</div>
                        <div class="stat-label">طلاب متصلين</div>
                        <div class="stat-trend trend-up">+12 منذ 5 دقائق</div>
                    </div>
                    <div class="quick-stat">
                        <div class="stat-icon">🏆</div>
                        <div class="stat-number" id="activeCompetitions">3</div>
                        <div class="stat-label">مسابقات نشطة</div>
                        <div class="stat-trend trend-up">2 في الانتظار</div>
                    </div>
                    <div class="quick-stat">
                        <div class="stat-icon">📊</div>
                        <div class="stat-number" id="avgScore">87%</div>
                        <div class="stat-label">متوسط الدرجات</div>
                        <div class="stat-trend trend-up">+5% عن أمس</div>
                    </div>
                    <div class="quick-stat">
                        <div class="stat-icon">⚡</div>
                        <div class="stat-number" id="completionRate">92%</div>
                        <div class="stat-label">معدل الإنجاز</div>
                        <div class="stat-trend trend-up">ممتاز</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section hidden">
                <div class="section-title">📊 لوحة المعلومات الشاملة</div>
                <!-- Dashboard content would go here -->
            </div>

            <!-- Questions Section -->
            <div id="questions-section" class="content-section hidden">
                <div class="section-title">❓ بنك الأسئلة المتقدم</div>
                
                <!-- Weekly Progress -->
                <div class="weekly-progress-section">
                    <div class="progress-header">
                        <div class="progress-title">
                            📈 التقدم الأسبوعي
                        </div>
                        <div style="color: #10b981; font-weight: 700;">
                            <span id="weeklyStatus">23 من 100</span>
                        </div>
                    </div>
                    <div class="weekly-progress-bar">
                        <div class="weekly-progress-fill" id="weeklyProgressBar" style="width: 23%;">
                            <div class="progress-text" id="progressText">23%</div>
                        </div>
                    </div>
                    <div class="progress-info">
                        <span>بداية الأسبوع: 2 سبتمبر</span>
                        <span>الهدف: 100 سؤال/أسبوع</span>
                        <span>متبقي: 77 سؤال</span>
                    </div>
                </div>

                <!-- Question Management Methods -->
                <div class="question-methods">
                    <div class="method-card" onclick="showQuestionMethod('excel')">
                        <div class="method-icon">📊</div>
                        <div class="method-title">استيراد Excel</div>
                        <div class="method-description">
                            رفع ملف Excel يحتوي على أسئلة متعددة<br>
                            مثالي للكميات الكبيرة (50-100 سؤال)
                        </div>
                    </div>
                    <div class="method-card" onclick="showQuestionMethod('smart')">
                        <div class="method-icon">🧠</div>
                        <div class="method-title">النموذج الذكي</div>
                        <div class="method-description">
                            إدخال سؤال واحد بنموذج تفاعلي<br>
                            مثالي للأسئلة المخصصة والمراجعة
                        </div>
                    </div>
                    <div class="method-card" onclick="showQuestionMethod('template')">
                        <div class="method-icon">📋</div>
                        <div class="method-title">نظام القوالب</div>
                        <div class="method-description">
                            استخدام قوالب جاهزة حسب المادة<br>
                            مثالي للأنماط المتكررة والسرعة
                        </div>
                    </div>
                </div>

                <!-- Recent Questions -->
                <div class="recent-questions">
                    <div class="section-title">🕐 الأسئلة المضافة حديثاً</div>
                    <div id="recentQuestionsList">
                        <!-- سيتم تحميل الأسئلة هنا -->
                        <div style="text-align: center; color: #94a3b8; padding: 20px;">
                            لا توجد أسئلة مضافة حديثاً
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other sections -->
            <div id="competitions-section" class="content-section hidden">
                <div class="section-title">🏆 إدارة المسابقات</div>
            </div>

            <div id="students-section" class="content-section hidden">
                <div class="section-title">👥 متابعة الطلاب</div>
            </div>

            <div id="analytics-section" class="content-section hidden">
                <div class="section-title">📈 التحليلات المتقدمة</div>
            </div>

            <div id="reports-section" class="content-section hidden">
                <div class="section-title">📊 التقارير الذكية</div>
            </div>

            <div id="settings-section" class="content-section hidden">
                <div class="section-title">⚙️ إعدادات النظام</div>
            </div>
        </main>
    </div>

    <!-- Enhanced Modals -->
    
    <!-- Excel Upload Modal -->
    <div id="excelUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">📊 استيراد أسئلة من Excel</div>
                <button class="close-btn" onclick="hideModal('excelUploadModal')">&times;</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">تحميل القالب المعياري:</label>
                <button class="btn btn-secondary" onclick="downloadExcelTemplate()">
                    📥 تحميل قالب Excel
                </button>
                <p style="color: #94a3b8; font-size: 0.9em; margin-top: 8px;">
                    احفظ القالب، املأه بالأسئلة، ثم ارفعه مرة أخرى
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">رفع ملف الأسئلة:</label>
                <input type="file" class="form-control" id="excelFileInput" accept=".xlsx,.xls,.csv">
            </div>

            <div id="excelUploadProgress" class="upload-progress hidden">
                <div style="color: #e2e8f0; font-weight: 600; margin-bottom: 10px;" id="excelUploadStatus">
                    جاري الرفع...
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="excelProgressBar"></div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-secondary" onclick="hideModal('excelUploadModal')">إلغاء</button>
            </div>
        </div>
    </div>

    <!-- Smart Question Modal -->
    <div id="smartQuestionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">🧠 إضافة سؤال ذكي</div>
                <button class="close-btn" onclick="hideModal('smartQuestionModal')">&times;</button>
            </div>
            
            <form id="smartQuestionForm">
                <div class="form-group">
                    <label class="form-label">نص السؤال:</label>
                    <textarea class="form-control" id="questionText" rows="3" placeholder="اكتب السؤال هنا..." required></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">المادة:</label>
                        <select class="form-control" id="questionSubject" required>
                            <option value="">اختر المادة</option>
                            <option value="math">الرياضيات</option>
                            <option value="science">العلوم</option>
                            <option value="history">التاريخ</option>
                            <option value="geography">الجغرافيا</option>
                            <option value="arabic">اللغة العربية</option>
                            <option value="islamic">التربية الإسلامية</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">المستوى:</label>
                        <select class="form-control" id="questionGrade" required>
                            <option value="">اختر المستوى</option>
                            <option value="الأول متوسط">الأول متوسط</option>
                            <option value="الثاني متوسط">الثاني متوسط</option>
                            <option value="الثالث متوسط">الثالث متوسط</option>
                            <option value="الأول ثانوي">الأول ثانوي</option>
                            <option value="الثاني ثانوي">الثاني ثانوي</option>
                            <option value="الثالث ثانوي">الثالث ثانوي</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label class="form-label">الصعوبة:</label>
                        <select class="form-control" id="questionDifficulty" required>
                            <option value="">اختر الصعوبة</option>
                            <option value="سهل">سهل</option>
                            <option value="متوسط">متوسط</option>
                            <option value="صعب">صعب</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">النقاط:</label>
                        <input type="number" class="form-control" id="questionPoints" value="10" min="5" max="50" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">الخيارات:</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" class="form-control" id="questionOption1" placeholder="الخيار الأول" required>
                        <input type="text" class="form-control" id="questionOption2" placeholder="الخيار الثاني" required>
                        <input type="text" class="form-control" id="questionOption3" placeholder="الخيار الثالث" required>
                        <input type="text" class="form-control" id="questionOption4" placeholder="الخيار الرابع" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">الإجابة الصحيحة:</label>
                    <select class="form-control" id="questionCorrectAnswer" required>
                        <option value="">اختر الإجابة الصحيحة</option>
                        <option value="1">الخيار الأول</option>
                        <option value="2">الخيار الثاني</option>
                        <option value="3">الخيار الثالث</option>
                        <option value="4">الخيار الرابع</option>
                    </select>
                </div>

                <div style="text-align: center; margin-top: 25px; display: flex; gap: 10px; justify-content: center;">
                    <button type="submit" class="btn">💾 حفظ السؤال</button>
                    <button type="button" class="btn btn-success" onclick="saveQuestionAndNext()">💾➕ حفظ ومتابعة</button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('smartQuestionModal')">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Template Selection Modal -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">📋 اختيار قالب السؤال</div>
                <button class="close-btn" onclick="hideModal('templateModal')">&times;</button>
            </div>
            
            <div class="question-methods">
                <div class="method-card" onclick="selectQuestionTemplate('math')">
                    <div class="method-icon">🔢</div>
                    <div class="method-title">قالب الرياضيات</div>
                    <div class="method-description">
                        أسئلة حسابية ومعادلات<br>
                        مسائل كلامية وهندسة
                    </div>
                </div>
                <div class="method-card" onclick="selectQuestionTemplate('science')">
                    <div class="method-icon">🔬</div>
                    <div class="method-title">قالب العلوم</div>
                    <div class="method-description">
                        فيزياء وكيمياء وأحياء<br>
                        تجارب وقوانين علمية
                    </div>
                </div>
                <div class="method-card" onclick="selectQuestionTemplate('history')">
                    <div class="method-icon">📚</div>
                    <div class="method-title">قالب التاريخ</div>
                    <div class="method-description">
                        أحداث تاريخية وشخصيات<br>
                        تواريخ ومعارك مهمة
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration and Main JavaScript -->
    <script type="module">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA5yepZwrOlqFiV_KkVHp9dBaaT65pgdRo",
            authDomain: "nafs-competition.firebaseapp.com",
            projectId: "nafs-competition",
            storageBucket: "nafs-competition.firebasestorage.app",
            messagingSenderId: "182205828634",
            appId: "1:182205828634:web:dee889f770eb52ff668ba3",
            measurementId: "G-MLR86M05H7"
        };

        // Initialize Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
            getFirestore, 
            collection, 
            doc,
            addDoc, 
            getDocs,
            updateDoc,
            deleteDoc,
            serverTimestamp,
            query,
            where,
            orderBy,
            limit
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global Variables
        window.db = db;
        window.auth = auth;
        let weeklyQuestionCount = 23;
        let weeklyGoal = 100;

        // Authentication
        signInAnonymously(auth).then(() => {
            console.log('تم تسجيل الدخول بنجاح');
            loadRecentQuestions();
        }).catch((error) => {
            console.error('خطأ في المصادقة:', error);
        });

        // Global Functions
        window.showQuestionMethod = function(method) {
            switch(method) {
                case 'excel':
                    showModal('excelUploadModal');
                    break;
                case 'smart':
                    showModal('smartQuestionModal');
                    break;
                case 'template':
                    showModal('templateModal');
                    break;
            }
        };

        window.downloadExcelTemplate = function() {
            const templateData = [
                ['نص السؤال', 'المادة', 'المستوى', 'الصعوبة', 'النقاط', 'الخيار الأول', 'الخيار الثاني', 'الخيار الثالث', 'الخيار الرابع', 'الإجابة الصحيحة (رقم)'],
                ['ما ناتج 5 + 3؟', 'math', 'الأول متوسط', 'سهل', '10', '6', '7', '8', '9', '2'],
                ['ما هو الرمز الكيميائي للماء؟', 'science', 'الثاني متوسط', 'سهل', '10', 'H2O', 'CO2', 'O2', 'H2', '1'],
                ['في أي عام تأسست المملكة؟', 'history', 'الثالث متوسط', 'متوسط', '15', '1930', '1932', '1935', '1940', '2']
            ];

            const csvContent = templateData.map(row => row.join(',')).join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'قالب_الأسئلة_نافس.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('تم تحميل القالب بنجاح! املأه وارفعه مرة أخرى');
        };

        window.handleSmartQuestionSubmit = async function(event) {
            event.preventDefault();
            
            const questionData = {
                text: document.getElementById('questionText').value,
                subject: document.getElementById('questionSubject').value,
                grade: document.getElementById('questionGrade').value,
                difficulty: document.getElementById('questionDifficulty').value,
                points: parseInt(document.getElementById('questionPoints').value),
                options: [
                    document.getElementById('questionOption1').value,
                    document.getElementById('questionOption2').value,
                    document.getElementById('questionOption3').value,
                    document.getElementById('questionOption4').value
                ],
                correct: parseInt(document.getElementById('questionCorrectAnswer').value),
                isActive: true,
                createdAt: serverTimestamp(),
                createdBy: 'نواف الصبحي'
            };

            try {
                await addDoc(collection(db, 'questions'), questionData);
                showNotification('تم حفظ السؤال بنجاح!');
                updateWeeklyProgress(1);
                loadRecentQuestions();
                
                // Reset form
                document.getElementById('smartQuestionForm').reset();
                document.getElementById('questionPoints').value = '10';
                hideModal('smartQuestionModal');
                
            } catch (error) {
                console.error('خطأ في حفظ السؤال:', error);
                showNotification('حدث خطأ في حفظ السؤال', 'error');
            }
        };

        window.saveQuestionAndNext = function() {
            const form = document.getElementById('smartQuestionForm');
            const event = new Event('submit');
            handleSmartQuestionSubmit(event).then(() => {
                // Reset form but keep modal open
                document.getElementById('smartQuestionForm').reset();
                document.getElementById('questionPoints').value = '10';
                showNotification('تم الحفظ! يمكنك إضافة سؤال آخر');
            });
        };

        window.selectQuestionTemplate = function(templateType) {
            hideModal('templateModal');
            
            const templates = {
                'math': {
                    subject: 'math',
                    examples: [
                        'ما ناتج العملية الحسابية؟',
                        'احسب قيمة المتغير في المعادلة؟',
                        'ما هي مساحة الشكل الهندسي؟'
                    ]
                },
                'science': {
                    subject: 'science',
                    examples: [
                        'ما هو الرمز الكيميائي للعنصر؟',
                        'ما هي وحدة قياس القوة؟',
                        'ما هو نوع التفاعل الكيميائي؟'
                    ]
                },
                'history': {
                    subject: 'history',
                    examples: [
                        'في أي عام حدث هذا الحدث؟',
                        'من هو الشخص المسؤول عن؟',
                        'ما هي أسباب هذه الحرب؟'
                    ]
                }
            };

            const template = templates[templateType];
            if (template) {
                showModal('smartQuestionModal');
                document.getElementById('questionSubject').value = template.subject;
                const subjectNames = {
                    'math': 'الرياضيات',
                    'science': 'العلوم',
                    'history': 'التاريخ',
                    'geography': 'الجغرافيا',
                    'arabic': 'اللغة العربية',
                    'islamic': 'التربية الإسلامية'
                };
                showNotification(`تم اختيار قالب ${subjectNames[template.subject]}! يمكنك الآن البدء في الإدخال`);
            }
        };

        window.updateWeeklyProgress = function(newQuestions) {
            weeklyQuestionCount += newQuestions;
            const progressPercentage = (weeklyQuestionCount / weeklyGoal) * 100;
            
            const progressBar = document.getElementById('weeklyProgressBar');
            const progressText = document.getElementById('progressText');
            const weeklyStatus = document.getElementById('weeklyStatus');
            
            if (progressBar) progressBar.style.width = progressPercentage + '%';
            if (progressText) progressText.textContent = Math.round(progressPercentage) + '%';
            if (weeklyStatus) weeklyStatus.textContent = `${weeklyQuestionCount} من ${weeklyGoal}`;
            
            if (weeklyQuestionCount >= weeklyGoal) {
                showNotification('مبروك! لقد حققت هدف الأسبوع 🎉', 'success');
            }
        };

        window.loadRecentQuestions = async function() {
            try {
                const q = query(
                    collection(db, 'questions'),
                    orderBy('createdAt', 'desc'),
                    limit(5)
                );
                
                const querySnapshot = await getDocs(q);
                const recentList = document.getElementById('recentQuestionsList');
                if (recentList) {
                    recentList.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        recentList.innerHTML = `
                            <div style="text-align: center; color: #94a3b8; padding: 20px;">
                                لا توجد أسئلة مضافة حديثاً
                            </div>
                        `;
                    } else {
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            const questionElement = createRecentQuestionElement(data);
                            recentList.appendChild(questionElement);
                        });
                    }
                }
                
            } catch (error) {
                console.error('خطأ في تحميل الأسئلة:', error);
            }
        };

        function createRecentQuestionElement(questionData) {
            const div = document.createElement('div');
            div.style.cssText = 'background: rgba(255, 255, 255, 0.1); border-radius: 10px; padding: 15px; margin-bottom: 10px;';
            
            const subjectNames = {
                'math': 'الرياضيات',
                'science': 'العلوم',
                'history': 'التاريخ',
                'geography': 'الجغرافيا',
                'arabic': 'اللغة العربية',
                'islamic': 'التربية الإسلامية'
            };
            
            div.innerHTML = `
                <div style="color: #e2e8f0; font-weight: 600; margin-bottom: 8px;">${questionData.text}</div>
                <div style="display: flex; gap: 10px; font-size: 0.9em; color: #94a3b8;">
                    <span>${subjectNames[questionData.subject] || questionData.subject}</span>
                    <span>${questionData.difficulty}</span>
                    <span>${questionData.grade}</span>
                    <span style="color: #10b981;">✓ معتمد</span>
                </div>
            `;
            
            return div;
        }

        // Form submission handling
        document.addEventListener('DOMContentLoaded', function() {
            const smartForm = document.getElementById('smartQuestionForm');
            if (smartForm) {
                smartForm.addEventListener('submit', handleSmartQuestionSubmit);
            }
            
            const fileInput = document.getElementById('excelFileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleExcelFile);
            }
        });

        function handleExcelFile(event) {
            const file = event.target.files[0];
            if (file) {
                processExcelFile(file);
            }
        }

        function processExcelFile(file) {
            const uploadProgress = document.getElementById('excelUploadProgress');
            const progressBar = document.getElementById('excelProgressBar');
            const status = document.getElementById('excelUploadStatus');
            
            uploadProgress.classList.remove('hidden');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                
                if (progress < 30) {
                    status.textContent = 'جاري رفع الملف...';
                } else if (progress < 60) {
                    status.textContent = 'جاري معالجة البيانات...';
                } else if (progress < 90) {
                    status.textContent = 'جاري التحقق من صحة الأسئلة...';
                } else {
                    status.textContent = 'جاري الحفظ في قاعدة البيانات...';
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        uploadProgress.classList.add('hidden');
                        hideModal('excelUploadModal');
                        showNotification('تم استيراد 100 سؤال بنجاح!');
                        updateWeeklyProgress(100);
                        loadRecentQuestions();
                    }, 1000);
                }
            }, 200);
        }
    </script>

    <!-- Regular JavaScript -->
    <script>
        // Sidebar Management
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // Navigation Management
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('[id$="-section"]').forEach(section => {
                        section.classList.add('hidden');
                    });
                    
                    const sectionName = this.dataset.section;
                    const section = document.getElementById(sectionName + '-section');
                    if (section) {
                        section.classList.remove('hidden');
                    }
                    
                    updatePageTitle(sectionName);
                    
                    // Load recent questions when switching to questions section
                    if (sectionName === 'questions') {
                        setTimeout(() => {
                            if (window.loadRecentQuestions) {
                                window.loadRecentQuestions();
                            }
                        }, 100);
                    }
                });
            });
        });

        function updatePageTitle(section) {
            const titles = {
                'live-control': {
                    title: 'التحكم المباشر في المسابقات',
                    subtitle: 'إدارة شاملة ومراقبة فورية للمسابقات النشطة'
                },
                'dashboard': {
                    title: 'لوحة المعلومات الشاملة',
                    subtitle: 'نظرة عامة على جميع الأنشطة والإحصائيات'
                },
                'questions': {
                    title: 'بنك الأسئلة المتقدم',
                    subtitle: `إدارة ذكية للأسئلة - 23 من 100 هذا الأسبوع`
                },
                'competitions': {
                    title: 'إدارة المسابقات',
                    subtitle: 'إنشاء ومراقبة المسابقات التفاعلية'
                },
                'students': {
                    title: 'متابعة الطلاب',
                    subtitle: 'مراقبة الأداء والتقدم الأكاديمي'
                },
                'analytics': {
                    title: 'التحليلات المتقدمة',
                    subtitle: 'تحليل البيانات والإحصائيات التفصيلية'
                },
                'reports': {
                    title: 'التقارير الذكية',
                    subtitle: 'تقارير شاملة ومخصصة للأداء'
                },
                'settings': {
                    title: 'إعدادات النظام',
                    subtitle: 'تخصيص وإعداد المنصة التعليمية'
                }
            };
            
            const pageInfo = titles[section] || titles['live-control'];
            const titleElement = document.getElementById('pageTitle');
            const subtitleElement = document.getElementById('pageSubtitle');
            
            if (titleElement) titleElement.textContent = pageInfo.title;
            if (subtitleElement) subtitleElement.textContent = pageInfo.subtitle;
        }

        // Modal Management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const toast = document.getElementById('notificationToast');
            if (toast) {
                toast.textContent = message;
                toast.className = `notification-toast ${type} show`;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 4000);
            }
        }

        // Control Functions
        function pauseAllCompetitions() {
            showNotification('تم إيقاف جميع المسابقات مؤقتاً', 'warning');
        }

        function emergencyStop() {
            if (confirm('هل أنت متأكد من الإيقاف الطارئ لجميع المسابقات؟')) {
                showNotification('تم الإيقاف الطارئ للنظام', 'error');
            }
        }

        function toggleNotifications() {
            showNotification('مركز الإشعارات قيد التطوير', 'warning');
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                hideModal(e.target.id);
            }
        });

        // Auto-save functionality (using memory instead of localStorage)
        let autoSaveInterval;
        let draftData = {}; // Store draft in memory

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                const form = document.getElementById('smartQuestionForm');
                if (form && !form.classList.contains('hidden')) {
                    const formData = new FormData(form);
                    draftData = {};
                    
                    // Collect form data
                    formData.forEach((value, key) => {
                        draftData[key] = value;
                    });
                    
                    // Also collect values from elements with IDs
                    const inputs = form.querySelectorAll('input, select, textarea');
                    inputs.forEach(input => {
                        if (input.id && input.value) {
                            draftData[input.id] = input.value;
                        }
                    });
                    
                    console.log('تم حفظ المسودة تلقائياً في الذاكرة');
                }
            }, 30000); // كل 30 ثانية
        }

        function loadDraft() {
            if (draftData && Object.keys(draftData).length > 0) {
                try {
                    Object.keys(draftData).forEach(key => {
                        const element = document.getElementById(key);
                        if (element && draftData[key]) {
                            element.value = draftData[key];
                        }
                    });
                    showNotification('تم استرجاع المسودة المحفوظة');
                } catch (error) {
                    console.error('خطأ في استرجاع المسودة:', error);
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Start auto-save
            startAutoSave();
            
            // Load draft if available
            setTimeout(loadDraft, 1000);
            
            // Initialize tooltips or other UI elements here if needed
            console.log('تم تحميل لوحة التحكم بنجاح');
        });

        // Cleanup when page unloads
        window.addEventListener('beforeunload', function() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        // Save current form if open
                        const activeModal = document.querySelector('.modal.show');
                        if (activeModal && activeModal.id === 'smartQuestionModal') {
                            const form = document.getElementById('smartQuestionForm');
                            if (form && window.handleSmartQuestionSubmit) {
                                window.handleSmartQuestionSubmit(new Event('submit'));
                            }
                        }
                        break;
                    case 'n':
                        e.preventDefault();
                        // Open new question modal
                        showModal('smartQuestionModal');
                        break;
                    case 'Escape':
                        e.preventDefault();
                        // Close active modal
                        const openModal = document.querySelector('.modal.show');
                        if (openModal) {
                            hideModal(openModal.id);
                        }
                        break;
                }
            }
        });

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('خطأ في التطبيق:', e.error);
            showNotification('حدث خطأ غير متوقع. يرجى إعادة تحميل الصفحة.', 'error');
        });

        // Make functions globally available
        window.showModal = showModal;
        window.hideModal = hideModal;
        window.showNotification = showNotification;
        window.toggleSidebar = toggleSidebar;
        window.pauseAllCompetitions = pauseAllCompetitions;
        window.emergencyStop = emergencyStop;
        window.toggleNotifications = toggleNotifications;
    </script>
</body>
</html>
